<!DOCTYPE html>
<html lang="es">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Medico</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="../css/vista_medico.css">
    <link rel="stylesheet" href="../css/bootstrap.css" />

</head>

<body class="bg-gray-100 min-h-screen">
    <div class="container mx-auto px-4 py-8">
        <!-- Header -->
        <nav class="bg-green-400 shadow-md rounded-lg mb-8 p-6 flex justify-between items-center">
            <!-- logo a la derecha -->
            <div class="flex-shrink-0">
                <img src="../resources/images/logo_yourpill.png" alt="YourPill Logo" class="h-12 w-auto" />
            </div>
            <!-- usuario a la izquierda -->
            <div class="flex gap-5 text-xl items-center">
                <div class="flex items-center space-x-2">
                    <i class="fas fa-user text-white text-2xl"></i>
                    <span id="nombre-usuario" class="font-medium text-white">Cargando...</span>
                </div>
                <button title="cerrar sesión" onclick="window.location.href='../backend/logout.php'">
                    <i class="fas fa-sign-out-alt text-white"></i>
                </button>
                <button title="Notificaciones">
                    <i class="fas fa-bell text-white"></i>
                </button>
                <button title="Configuración">
                    <i class="fas fa-cog text-white"></i>
                </button>
            </div>
        </nav>

        <!-- Main Content -->
        <main class="bg-white shadow-md rounded-lg overflow-hidden">
            <!-- Tabs Navigation -->
            <div class="flex border-b border-green-400 bg-green-50">
                <button id="patient-tab"
                    class="tab-active px-6 py-4 text-lg font-medium flex items-center text-green-700 hover:bg-green-100 transition">
                    <i class="fas fa-user-injured mr-2"></i> Pacientes
                </button>
                <button id="doctor-tab"
                    class="px-6 py-4 text-lg font-medium flex items-center text-green-700 hover:bg-green-100 transition">
                    <i class="fas fa-clipboard-list mr-2"></i> Recetar
                </button>

            </div>

            <!-- Tabla de contenido -->
            <div class="p-6">
                <!-- Pacientes -->
                <div id="patient-content" class="tab-content">
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-8">
                        <div>
                            <h2 class="text-xl font-bold mb-4 text-gray-800">Información del Paciente</h2>
                            <div class="bg-gray-50 p-6 rounded-lg mb-6">
                                <div class="flex items-center mb-4">
                                    <img src="https://randomuser.me/api/portraits/women/44.jpg" alt="Patient"
                                        class="w-16 h-16 rounded-full mr-4">
                                    <div>
                                        <h3 class="font-bold text-lg">María González</h3>
                                        <p class="text-gray-600">Edad: 32 años</p>
                                        <p class="text-gray-600">Tipo de sangre: O+</p>
                                    </div>
                                </div>

                                <div class="mb-4">
                                    <h4 class="font-medium mb-2">Alergias</h4>
                                    <div class="flex flex-wrap gap-2">
                                        <span
                                            class="bg-red-100 text-red-800 px-3 py-1 rounded-full text-sm">Penicilina</span>
                                        <span
                                            class="bg-red-100 text-red-800 px-3 py-1 rounded-full text-sm">Mariscos</span>
                                        <button id="add-allergy-btn"
                                            class="bg-gray-200 text-gray-700 px-3 py-1 rounded-full text-sm hover:bg-gray-300">
                                            <i class="fas fa-plus mr-1"></i> Agregar
                                        </button>
                                    </div>
                                </div>

                                <div id="allergy-form" class="hidden mb-4">
                                    <div class="flex">
                                        <input type="text" id="new-allergy"
                                            class="flex-grow px-3 py-2 border rounded-l-lg focus:ring-blue-500 focus:border-blue-500"
                                            placeholder="Nueva alergia">
                                        <button id="save-allergy-btn"
                                            class="bg-blue-500 text-white px-4 py-2 rounded-r-lg hover:bg-blue-600">
                                            <i class="fas fa-check"></i>
                                        </button>
                                    </div>
                                </div>

                                <div>
                                    <h4 class="font-medium mb-2">Historial Médico</h4>
                                    <div class="space-y-2">
                                        <div
                                            class="flex items-center justify-between bg-white p-3 rounded-lg shadow-sm">
                                            <span>Consulta general - 15/05/2023</span>
                                            <button class="text-blue-500 hover:text-blue-700">
                                                <i class="fas fa-download"></i>
                                            </button>
                                        </div>
                                        <div
                                            class="flex items-center justify-between bg-white p-3 rounded-lg shadow-sm">
                                            <span>Examen de sangre - 10/04/2023</span>
                                            <button class="text-blue-500 hover:text-blue-700">
                                                <i class="fas fa-download"></i>
                                            </button>
                                        </div>
                                    </div>
                                    <button
                                        class="mt-3 w-full bg-gray-100 hover:bg-gray-200 text-gray-800 py-2 px-4 rounded-lg flex items-center justify-center">
                                        <i class="fas fa-upload mr-2"></i> Subir nuevo documento
                                    </button>
                                </div>
                            </div>
                        </div>

                        <div>
                            <h2 class="text-xl font-bold mb-4 text-gray-800">Medicación Actual</h2>
                            <div class="bg-blue-50 p-6 rounded-lg mb-6">
                                <h3 class="font-bold mb-3">Prescripción actual</h3>
                                <div class="bg-white p-4 rounded-lg shadow-sm mb-4">
                                    <div class="flex justify-between items-start mb-2">
                                        <div>
                                            <h4 class="font-medium">Paracetamol</h4>
                                            <p class="text-sm text-gray-600">500mg - Cada 8 horas</p>
                                        </div>
                                        <span class="bg-blue-100 text-blue-800 px-2 py-1 rounded text-xs">Activa</span>
                                    </div>
                                    <p class="text-sm text-gray-700 mb-2">Indicaciones: Tomar con alimentos. No exceder
                                        4g por día.</p>
                                    <p class="text-xs text-gray-500">Recetado por: Dr. Juan Pérez - 20/05/2023</p>
                                </div>

                                <h3 class="font-bold mb-3">Control de Medicación</h3>
                                <div class="bg-white p-4 rounded-lg shadow-sm">
                                    <table class="w-full">
                                        <thead>
                                            <tr class="border-b">
                                                <th class="text-left pb-2">Día</th>
                                                <th class="text-left pb-2">Mañana</th>
                                                <th class="text-left pb-2">Tarde</th>
                                                <th class="text-left pb-2">Noche</th>
                                            </tr>
                                        </thead>
                                        <tbody>
                                            <tr class="border-b">
                                                <td class="py-2">Lunes</td>
                                                <td class="py-2">
                                                    <button class="status-btn bg-green-500 text-white px-2 py-1 rounded"
                                                        data-status="taken">✓</button>
                                                </td>
                                                <td class="py-2">
                                                    <button class="status-btn bg-red-500 text-white px-2 py-1 rounded"
                                                        data-status="missed">✗</button>
                                                </td>
                                                <td class="py-2">
                                                    <button class="status-btn bg-blue-500 text-white px-2 py-1 rounded"
                                                        data-status="postponed">↻</button>
                                                </td>
                                            </tr>
                                            <tr class="border-b">
                                                <td class="py-2">Martes</td>
                                                <td class="py-2">
                                                    <button
                                                        class="status-btn bg-gray-300 text-gray-600 px-2 py-1 rounded"
                                                        data-status="pending">-</button>
                                                </td>
                                                <td class="py-2">
                                                    <button
                                                        class="status-btn bg-gray-300 text-gray-600 px-2 py-1 rounded"
                                                        data-status="pending">-</button>
                                                </td>
                                                <td class="py-2">
                                                    <button
                                                        class="status-btn bg-gray-300 text-gray-600 px-2 py-1 rounded"
                                                        data-status="pending">-</button>
                                                </td>
                                            </tr>
                                        </tbody>
                                    </table>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <!-- Asignacion de formula medica -->
                <div id="doctor-content" class="tab-content hidden">
                    <div class="mb-8">
                        <h2 class="text-xl font-bold mb-4 text-gray-800">Formula medica</h2>
                        <form id="prescription-form" class="grid grid-cols-1 md:grid-cols-3 gap-6">
                            <div>
                                <label for="medication"
                                    class="block text-sm font-medium text-gray-700 mb-1">Medicamento</label>
                                <input type="text" id="medication"
                                    class="w-full px-4 py-2 border rounded-lg focus:ring-blue-500 focus:border-blue-500"
                                    required>
                            </div>
                            <div>
                                <label for="dose" class="block text-sm font-medium text-gray-700 mb-1">Dosis</label>
                                <input type="text" id="dose"
                                    class="w-full px-4 py-2 border rounded-lg focus:ring-blue-500 focus:border-blue-500"
                                    required>
                            </div>
                            <div>
                                <label for="frequency"
                                    class="block text-sm font-medium text-gray-700 mb-1">Frecuencia</label>
                                <select id="frequency"
                                    class="w-full px-4 py-2 border rounded-lg focus:ring-blue-500 focus:border-blue-500"
                                    required>
                                    <option value="">Seleccionar</option>
                                    <option value="1x día">1 vez al día</option>
                                    <option value="2x día">2 veces al día</option>
                                    <option value="3x día">3 veces al día</option>
                                    <option value="cada 4 horas">Cada 4 horas</option>
                                    <option value="cada 6 horas">Cada 6 horas</option>
                                    <option value="cada 8 horas">Cada 8 horas</option>
                                    <option value="cada 12 horas">Cada 12 horas</option>
                                </select>
                            </div>
                            <div class="md:col-span-3">
                                <label for="instructions"
                                    class="block text-sm font-medium text-gray-700 mb-1">Indicaciones</label>
                                <textarea id="instructions" rows="3"
                                    class="w-full px-4 py-2 border rounded-lg focus:ring-blue-500 focus:border-blue-500"
                                    required></textarea>
                            </div>
                            <div class="md:col-span-3">
                                <label for="patient-select"
                                    class="block text-sm font-medium text-gray-700 mb-1">Paciente</label>
                                <select id="patient-select"
                                    class="w-full px-4 py-2 border rounded-lg focus:ring-blue-500 focus:border-blue-500"
                                    required>
                                    <option value="">Seleccionar paciente</option>
                                    <option value="1">María González</option>
                                    <option value="2">Carlos Rodríguez</option>
                                    <option value="3">Ana Martínez</option>
                                    <option value="4">Luis Sánchez</option>
                                </select>
                            </div>
                            <div class="md:col-span-3 flex justify-end">
                                <button type="submit"
                                    class="bg-blue-500 hover:bg-blue-600 text-white px-6 py-2 rounded-lg font-medium transition duration-200">
                                    <i class="fas fa-save mr-2"></i> Guardar Prescripción
                                </button>
                            </div>
                        </form>
                    </div>

                </div>
            </div>
        </main>
    </div>

    <script>
        // Tab functionality
        const tabs = {
            'doctor-tab': 'doctor-content',
            'patient-tab': 'patient-content',
        };

        Object.keys(tabs).forEach(tabId => {
            document.getElementById(tabId).addEventListener('click', () => {
                // Hide all tab contents
                document.querySelectorAll('.tab-content').forEach(content => {
                    content.classList.add('hidden');
                });

                // Remove active class from all tabs
                document.querySelectorAll('[id$="-tab"]').forEach(tab => {
                    tab.classList.remove('tab-active');
                });

                // Show selected tab content and mark tab as active
                document.getElementById(tabs[tabId]).classList.remove('hidden');
                document.getElementById(tabId).classList.add('tab-active');
            });
        });

        // Prescription form submission
        document.getElementById('prescription-form').addEventListener('submit', function (e) {
            e.preventDefault();
            alert('Prescripción guardada exitosamente');
            this.reset();
        });

        // Allergy functionality
        document.getElementById('add-allergy-btn').addEventListener('click', function () {
            document.getElementById('allergy-form').classList.remove('hidden');
        });

        document.getElementById('save-allergy-btn').addEventListener('click', function () {
            const newAllergy = document.getElementById('new-allergy').value.trim();
            if (newAllergy) {
                const allergyBadge = document.createElement('span');
                allergyBadge.className = 'bg-red-100 text-red-800 px-3 py-1 rounded-full text-sm';
                allergyBadge.textContent = newAllergy;

                document.querySelector('.flex-wrap').insertBefore(allergyBadge, document.getElementById('add-allergy-btn'));
                document.getElementById('new-allergy').value = '';
                document.getElementById('allergy-form').classList.add('hidden');
            }
        });

        // Medication status buttons
        document.querySelectorAll('.status-btn').forEach(btn => {
            btn.addEventListener('click', function () {
                const status = this.getAttribute('data-status');
                let bgColor, text;

                switch (status) {
                    case 'taken':
                        bgColor = 'bg-green-500';
                        text = '✓';
                        break;
                    case 'missed':
                        bgColor = 'bg-red-500';
                        text = '✗';
                        break;
                    case 'postponed':
                        bgColor = 'bg-blue-500';
                        text = '↻';
                        break;
                    default:
                        bgColor = 'bg-gray-300';
                        text = '-';
                }

                this.className = `status-btn ${bgColor} text-white px-2 py-1 rounded`;
                this.innerHTML = text;

                // Here you would typically send this update to the server
                console.log(`Medication status updated to: ${status}`);
            });
        });
        document.addEventListener("DOMContentLoaded", () => {
            fetch('../backend/obtener_usuario.php', {
                credentials: 'include'
            })
                .then(res => res.json())
                .then(data => {
                    console.log("Datos recibidos del backend:", data); // 👈 Esto mostrará el JSON en la consola

                    const nombreCompleto = `${data.nombre} ${data.apellido}`.trim();
                    const span = document.getElementById('nombre-usuario');
                    span.textContent = nombreCompleto || 'Usuario';
                })
                .catch(err => {
                    console.error('Error al obtener el nombre:', err);
                    document.getElementById('nombre-usuario').textContent = 'Usuario';
                });
        });
    </script>
</body>

</html>